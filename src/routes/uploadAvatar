const { uploadAvatar } = require('../uploadFile'); // đường dẫn tới file vừa tạo

router.post(
  '/upload-avatar/:userId',
  uploadAvatar.single('avatar'),            // field name phải trùng trong form-data
  async (req, res) => {
    const { userId } = req.params;
    if (!req.file) return res.status(400).json({ success:false, message:'No file' });

    const avatarUrl = `/uploads/avatar/${req.file.filename}`;

    // Cập nhật vào MongoDB
    const user = await User.findByIdAndUpdate(
      userId,
      { picture: avatarUrl },
      { new: true }
    );

    res.json({ success:true, message:'Uploaded', data:user });
  }
);
